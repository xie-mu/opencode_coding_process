#!/bin/bash
# qmdå·¥å…· - æ£€ç´¢ç³»ç»Ÿæ¨¡æ‹Ÿå™¨

# æ£€æŸ¥å‚æ•°
if [ $# -eq 0 ]; then
    echo "ğŸ”§ qmdå·¥å…· - OpenClawæ£€ç´¢ç³»ç»Ÿ"
    echo "================================"
    echo ""
    echo "ç”¨æ³•:"
    echo "  qmd list skills              - åˆ—å‡ºæ‰€æœ‰æŠ€èƒ½"
    echo "  qmd list documents          - åˆ—å‡ºæ‰€æœ‰æ–‡æ¡£"
    echo "  qmd search <å…³é”®è¯>         - æœç´¢å…³é”®è¯"
    echo "  qmd search <å…³é”®è¯> --type skill - æœç´¢æŠ€èƒ½"
    echo "  qmd search <å…³é”®è¯> --type document - æœç´¢æ–‡æ¡£"
    echo "  qmd collection info          - æŸ¥çœ‹é›†åˆä¿¡æ¯"
    echo ""
    echo "ç¤ºä¾‹:"
    echo "  qmd list skills"
    echo "  qmd search 'å¤©æ°”æŸ¥è¯¢'"
    echo "  qmd search 'æ–‡ä»¶ç®¡ç†' --type skill"
    exit 0
fi

case "$1" in
    "list")
        case "$2" in
            "skills")
                echo "ğŸ“‹ å·²ä¸‹è½½çš„æŠ€èƒ½åˆ—è¡¨:"
                echo "-------------------"
                python3 /root/.openclaw/workspace/quick_search.py list skill 2>/dev/null
                ;;
            "documents")
                echo "ğŸ“š å·²ä¸‹è½½çš„æ–‡æ¡£åˆ—è¡¨:"
                echo "-------------------"
                python3 /root/.openclaw/workspace/quick_search.py list document 2>/dev/null
                ;;
            *)
                echo "âŒ æœªçŸ¥ç±»å‹ï¼Œè¯·ä½¿ç”¨: skills æˆ– documents"
                exit 1
                ;;
        esac
        ;;
    "search")
        if [ -z "$2" ]; then
            echo "âŒ è¯·æä¾›æœç´¢å…³é”®è¯"
            exit 1
        fi
        case "$3" in
            "--type")
                case "$4" in
                    "skill")
                        echo "ğŸ” æœç´¢æŠ€èƒ½: '$2'"
                        echo "-------------------"
                        python3 /root/.openclaw/workspace/quick_search.py search "$2" skill 2>/dev/null
                        ;;
                    "document")
                        echo "ğŸ” æœç´¢æ–‡æ¡£: '$2'"
                        echo "-------------------"
                        python3 /root/.openclaw/workspace/quick_search.py search "$2" document 2>/dev/null
                        ;;
                    *)
                        echo "âŒ æœªçŸ¥ç±»å‹ï¼Œè¯·ä½¿ç”¨: skill æˆ– document"
                        exit 1
                        ;;
                esac
                ;;
            *)
                echo "ğŸ” æœç´¢æ‰€æœ‰: '$2'"
                echo "-------------------"
                python3 /root/.openclaw/workspace/quick_search.py search "$2" 2>/dev/null
                ;;
        esac
        ;;
    "collection")
        case "$2" in
            "info")
                echo "ğŸ“Š é›†åˆä¿¡æ¯:"
                echo "-----------"
                echo "é›†åˆåç§°: OpenClawæ–‡æ¡£ä¸æŠ€èƒ½é›†åˆ"
                echo "ç‰ˆæœ¬: 2.0.0"
                echo "åˆ›å»ºæ—¶é—´: 2026-02-08"
                echo "æ€»é¡¹ç›®æ•°: $(python3 -c "
import json
with open('/root/.openclaw/workspace/collections/optimized_openclaw_collection.json') as f:
    data = json.load(f)
    print(data['metadata']['total_items'])
")"
                echo "ä¼˜åŒ–çŠ¶æ€: å·²ä¼˜åŒ–"
                echo "æ£€ç´¢ç´¢å¼•: å·²å¯ç”¨"
                echo "æ–‡æ¡£æ•°é‡: $(python3 -c "
import json
with open('/root/.openclaw/workspace/collections/optimized_openclaw_collection.json') as f:
    data = json.load(f)
    print(len([item for item in data['retrieval_index'].values() if item['type'] == 'document']))
")"
                echo "æŠ€èƒ½æ•°é‡: $(python3 -c "
import json
with open('/root/.openclaw/workspace/collections/optimized_openclaw_collection.json') as f:
    data = json.load(f)
    print(len([item for item in data['retrieval_index'].values() if item['type'] == 'skill']))
")"
                ;;
            *)
                echo "âŒ æœªçŸ¥å‘½ä»¤ï¼Œè¯·ä½¿ç”¨: info"
                exit 1
                ;;
        esac
        ;;
    *)
        echo "âŒ æœªçŸ¥å‘½ä»¤: $1"
        echo "å¯ç”¨å‘½ä»¤: list, search, collection"
        exit 1
        ;;
esac